{"ts":1366163696623,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"\nvar express = require('express');\nvar http = require(\"http\");\nvar io = require('socket.io');\nvar app = express();\n\n\nvar OAuth= require('oauth').OAuth;\n\nvar oa = new OAuth(\n    \"https://api.twitter.com/oauth/request_token\",\n    \"https://api.twitter.com/oauth/access_token\",\n    \"Mq5nZDXjwtM5JTuvGRckOw\",\n\t\"BJKqFZaKFnI1ynLYixOXDBhGrEqLmb4IpPHSfUVFEA\",\n\t\"1.0\",\n\t\"http://admios.hugo506.c9.io/twitter_callback\",\n\t\"HMAC-SHA1\"\t\n);\n\n\napp.configure(function(){\n  app.set('ip', process.env.IP);\n  app.set('port', process.env.PORT || 8080);\n  app.set('views', __dirname + '/views');\n  app.set('stylesheets', __dirname + '/stylesheets');\n  app.set('view engine', 'jade');\n});\n\napp.use(express.cookieParser());\napp.use(express.session( { secret: 'whatever' } ));\napp.use(express.bodyParser());\n\napp.get('/', function(req, res){\n  res.render('index', {\n    title: 'Login'\n  });\n});\n\napp.get('/stock_check', function(req, res){\n  res.render('stock_check', {\n    title: 'Check Stock Symbol'\n  });\n});\n\napp.post('/get_stock_data', function(req, res){ \n  \n  var symbol = req.body.symbol;\n  var parseString = require('xml2js').parseString;\n  var options = { \n      host: 'www.google.com',\n      path: '/ig/api?stock='+symbol};\n  \n  var request = http.get(options, function(response) {\n      \n    var xmlData = \"\";\n    response.setEncoding('utf8');\n    response.on('data', function (chunk) {\n      //console.log(chunk);\n      xmlData += chunk;\n    });\n\n\n    response.on('end', function(){\n      parseString(xmlData, function (err, result) {\n          var symbolName = result.xml_api_reply.finance[0].exchange[0]['$']['data'];\n          \n          if('UNKNOWN EXCHANGE' == symbolName){\n              res.send('Error invalid stock symbol');              \n          }else{\n              res.send('Symbol is valid');\n          }\n      });\n    });    \n\n  });\n\n});\n\n\n\napp.get('/twitter_auth', function(req, res){\n    oa.getOAuthRequestToken(function(error, oauth_token, oauth_token_secret, results){\n\t\tif (error) {\n\t\t\tconsole.log(error);\n\t\t\tres.send(\"yeah no. didn't work.\")\n\t\t}\n\t\telse {\n\t\t\treq.session.oauth = {};\n\t\t\treq.session.oauth.token = oauth_token;\n\t\t\t//console.log('oauth.token: ' + req.session.oauth.token);\n\t\t\treq.session.oauth.token_secret = oauth_token_secret;\n\t\t\t//console.log('oauth.token_secret: ' + req.session.oauth.token_secret);\n\t\t\tres.redirect('https://twitter.com/oauth/authenticate?oauth_token='+oauth_token)\n\t}\n\t});\n});\n\n\napp.get('/twitter_callback', function(req, res, next){\n    if (req.session.oauth) {\n\t\treq.session.oauth.verifier = req.query.oauth_verifier;\n\t\tvar oauth = req.session.oauth;\n\n\t\toa.getOAuthAccessToken(oauth.token,oauth.token_secret,oauth.verifier, \n\t\tfunction(error, oauth_access_token, oauth_access_token_secret, results){\n\t\t\tif (error){\n\t\t\t\tconsole.log(error);\n\t\t\t\tres.send(\"yeah something broke.\");\n\t\t\t} else {\n\t\t\t\treq.session.oauth.access_token = oauth_access_token;\n\t\t\t\treq.session.oauth.access_token_secret = oauth_access_token_secret;\n\t\t\t\tconsole.log(results);\n\t\t\t\t//res.send(\"worked. nice one.\");\n                res.render('stock_check', {\n                    title: 'Stock Check'\n                  });\n\t\t\t}\n\t\t}\n\t\t);\n\t} else\n\t\tnext(new Error(\"you're not supposed to be here.\"))\n});\n  \n\n// create a server\nvar server = http.createServer(app).listen(app.get('port'));\n\n\n//create the socket object\nvar socket = io.listen(server);\n\nsocket.on('connection', function(socket) {\n\n    socket.emit('symbolTweet',{data:'test'});\n\n/*\n  var Twit = require('twit');\n  var T = new Twit({\n                    consumer_key:         'Mq5nZDXjwtM5JTuvGRckOw'\n                  , consumer_secret:      'BJKqFZaKFnI1ynLYixOXDBhGrEqLmb4IpPHSfUVFEA'\n                  , access_token:         '1351190376-bGasUCIjA2tYikn9LWUzGGXrPt8Pulm5uko72Ef'\n                  , access_token_secret:  'EHTMLB8295DjYEL1z3b6ffOz9neeFVK1ohBM7e7n4'\n                });\n\n  var stream = T.stream('statuses/filter', { track: 'mango' });//symbolName\n  \n  stream.on('tweet', function (tweet) {                  \n      //console.log(tweet.user.name+\" says: \"+tweet.text);    \n      socket.emit('symbolTweet',{data: tweet.user.name+\" says: \"+tweet.text});\n  });\n  */\n                \n  /*T.stream('statuses/filter', { track: symbolName },\n    function(stream) {\n      stream.on('data',function(data){\n        socket.emit('twitter',data);\n      });\n    });*/\n});\n\n\n\n\n"]],"start1":0,"start2":0,"length1":0,"length2":4347}]],"length":4347}
{"ts":1366163980948,"patch":[[{"diffs":[[-1,"\n"],[0,"var express "]],"start1":0,"start2":0,"length1":13,"length2":12}]],"length":4346,"saved":false}
{"ts":1366165406254,"patch":[[{"diffs":[[1,"\n"],[0,"var express "]],"start1":0,"start2":0,"length1":12,"length2":13}]],"length":4347,"saved":false}
